version: '3.9'

services:
  node0: 
    image: ${IMAGE}:${TAG}
    ports:
      - "10000"
      - "20000"
      - "20100"
      - "30000"
      - "40000"
      - "50000"
      - "6001:6001"
    volumes:
      - $PWD/config0/config.toml:/config/config.toml:ro
      - $PWD/store0:/store
      - $PWD/log0:/log
    restart: on-failure
    tty: true
    networks: 
      monet:
        ipv4_address: 172.19.0.2

  node1:
    image: ${IMAGE}:${TAG}
    ports:
      - "10000"
      - "20000"
      - "20100"
      - "30000"
      - "40000"
      - "50000"
      - "6002:6001"
    volumes:
      - $PWD/config1/config.toml:/config/config.toml:ro 
      - $PWD/store1:/store
      - $PWD/log1:/log
    restart: on-failure
    tty: true
    networks: 
      monet:
        ipv4_address: 172.19.0.3

  node2:
    image: ${IMAGE}:${TAG}
    ports:
      - "40000"
      - "50000"
      - "20100"
      - "10000"
      - "20000"
      - "30000"
      - "6003:6001"
    volumes:
      - $PWD/config2/config.toml:/config/config.toml:ro
      - $PWD/store2:/store
      - $PWD/log2:/log
    restart: on-failure
    tty: true
    networks: 
      monet:
        ipv4_address: 172.19.0.4
networks:
  monet:
    driver: bridge
    ipam:
      config:
        - subnet: 172.19.0.0/16
